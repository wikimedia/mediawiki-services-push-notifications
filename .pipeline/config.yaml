pipelines:
  test:
    blubberfile: blubber.yaml
    stages:
      - name: built
        build: npm-run
      - name: test
        run:
          image: '${built.imageID}'
          arguments: [test]
      - name: codehealth_built
        build: codehealth
      - name: coverage
        run:
          image: '${codehealth_built.imageID}'
          env:
            ZUUL_BRANCH: ${ZUUL_BRANCH}
            ZUUL_CHANGE: ${ZUUL_CHANGE}
            ZUUL_PATCHSET: ${ZUUL_PATCHSET}
            ZUUL_PROJECT: ${ZULL_PROJECT}
          credentials:
            - id: SONAR_API_KEY
              name: SONAR_API_KEY
  publish:
    blubberfile: blubber.yaml
    stages:
      - name: publish
        build: production
        publish:
          image: true
